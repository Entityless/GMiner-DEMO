<!DOCTYPE html>
<html lang="en">
<body>
<div id="chartView"></div>
<script src="https://gw.alipayobjects.com/os/antv/pkg/_antv.g2-3.4.1/dist/g2.min.js"></script>
<script src="https://gw.alipayobjects.com/os/antv/assets/lib/jquery-3.2.1.min.js"></script>
<link rel="stylesheet" type="text/css" href="/css/dataVis.css">
<script>
const jsonPath = "/data/cpu-data.json";
const refreshInterval = 50000000000; //In ms
const numOfType = 3;         //Number of type to display
const maxItem   = 60;        //Maximun number of item in each json file
const chartColors = ['#1890ff', '#ff1429', '#2ef924'];
var items = [];
var chart = new G2.Chart({
    container: 'chartView',
    forceFit: false,
    height: 360,
    width: 480,
    animate: false,
    padding: [100, 100, 100, 100]
  });
chart.scale('time', {
    tickInterval: maxItem
  });
chart.scale('value', {
    max:1,
    min:0,
    formatter: val=>{ return val * 100 + "%";}
  });
chart.tooltip(false);
chart.line().position('time*value').color('type', chartColors);

for(i = 0; i < maxItem; i++){
    items.push({name: "0%",
                marker:{
                    symbol:'square',
                    fill: chartColors[i]
                }});
}

chart.legend({
  custom: true,
  position: 'top',
  items: items
});
chart.render();

var updateChart = function(){
   $.getJSON(jsonPath, function(data){
      index = 0;
      for(i = 0; i < data.length / numOfType; i++){
        for(j = 0; j < numOfType; j ++){
          data[index].time = i;
          index ++;
        }
      }
      index -= numOfType;
      // Update Current Value for each type
      for(j = 0; j < numOfType; j ++){
          items[j].value = data[index].type + ": " + data[index].value*100 + "%";
          index++;
      }
      chart.changeData(data);
   });
};

setInterval(updateChart, refreshInterval);
</script>
</body>
</html>
